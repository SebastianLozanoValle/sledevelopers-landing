---
const interests = [
  'Desarrollo Web',
  'Aplicaci贸n M贸vil',
  'Dise帽o UI/UX',
  'E-commerce',
  'Branding',
  'Consultor铆a'
];

const budgets = [
  '$20M - $40M',
  '$40M - $100M',
  '$100M - $200M',
  '$200M+'
];
---

<section class="mb-20 py-24 px-8 max-w-[1400px] mx-auto relative" id="contact">
  <div class="w-4/5 mx-auto">
    <!-- Header -->
    <div class="flex items-center justify-between mb-16 flex-wrap gap-6">
      <div class="flex items-center gap-2">
        <span class="bg-gray-900 w-2 h-2 rounded-full"></span>
        <span class="text-sm font-medium text-gray-600">Somos exploradores</span>
      </div>
      <h2 class="text-[clamp(2rem,4vw,2.5rem)] font-extrabold text-gray-900 leading-tight">
        驴Listo para dar el siguiente paso con nosotros?
      </h2>
    </div>

    <!-- Main Form Card -->
    <div class="bg-white border border-gray-200 rounded-3xl p-8 lg:p-12 shadow-lg" id="contact-form-container">
      <form id="contact-form" class="grid grid-cols-1 lg:grid-cols-2 gap-12">
        <!-- Left Side -->
        <div class="space-y-8">
          <button 
            type="button"
            class="bg-gray-100 text-gray-900 px-6 py-3 rounded-full text-sm font-medium hover:bg-gray-200 transition-colors"
          >
            Cont谩ctanos
          </button>
          <h3 class="text-[clamp(2.5rem,5vw,4rem)] font-extrabold text-gray-900 leading-tight">
            Hagamos un impacto
          </h3>
        </div>

        <!-- Right Side - Form -->
        <div class="space-y-8">
          <!-- Contact Information -->
          <div class="space-y-6">
            <div>
              <label for="name" class="block text-sm font-medium text-gray-700 mb-2">Nombre</label>
              <input
                type="text"
                id="name"
                name="name"
                class="w-4/5 border-0 border-b border-gray-300 focus:border-gray-900 focus:ring-0 pb-2 text-lg bg-transparent transition-colors"
                required
              />
            </div>
            
            <div>
              <label for="company" class="block text-sm font-medium text-gray-700 mb-2">Empresa</label>
              <input
                type="text"
                id="company"
                name="company"
                class="w-4/5 border-0 border-b border-gray-300 focus:border-gray-900 focus:ring-0 pb-2 text-lg bg-transparent transition-colors"
              />
            </div>
            
            <div>
              <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Tu Email</label>
              <input
                type="email"
                id="email"
                name="email"
                class="w-4/5 border-0 border-b border-gray-300 focus:border-gray-900 focus:ring-0 pb-2 text-lg bg-transparent transition-colors"
                required
              />
            </div>
            
            <div>
              <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">Tu Tel茅fono</label>
              <input
                type="tel"
                id="phone"
                name="phone"
                placeholder="Tu n煤mero de tel茅fono"
                class="w-4/5 border-0 border-b border-gray-300 focus:border-gray-900 focus:ring-0 pb-2 text-lg bg-transparent transition-colors placeholder:text-gray-400"
              />
            </div>
          </div>

          <!-- Interests -->
          <div>
            <h4 class="text-lg font-semibold text-gray-900 mb-4">Estoy interesado en...</h4>
            <div class="grid grid-cols-2 gap-3" id="interests-container">
              {interests.map((interest) => (
                <button
                  type="button"
                  data-interest={interest}
                  class="interest-btn px-4 py-2 rounded-full text-sm font-medium transition-colors bg-gray-100 text-gray-900 hover:bg-gray-200"
                >
                  {interest}
                </button>
              ))}
            </div>
          </div>

          <!-- Budget -->
          <div>
            <h4 class="text-lg font-semibold text-gray-900 mb-4">Presupuesto del Proyecto (COP)</h4>
            <div class="flex flex-wrap gap-3 relative" id="budget-container" style="min-height: 50px;">
              {budgets.map((budget) => (
                <button
                  type="button"
                  data-budget={budget}
                  class="budget-btn px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 cursor-pointer bg-gray-100 text-gray-900 hover:bg-gray-200"
                >
                  {budget}
                </button>
              ))}
              <button
                type="button"
                id="discountButton"
                data-budget="Descuento 20%"
                class="discount-button budget-btn px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 cursor-pointer bg-gradient-to-r from-purple-600 to-blue-600 text-white hover:shadow-lg whitespace-nowrap"
              >
                 20% OFF
              </button>
            </div>
            <p class="text-xs text-gray-500 mt-2">*Marca esta casilla para obtener el descuento</p>
          </div>

          <!-- Project Description -->
          <div>
            <h4 class="text-lg font-semibold text-gray-900 mb-4">Cu茅ntanos sobre tu proyecto.</h4>
            <textarea
              id="project"
              name="project"
              placeholder="Escribe algo conciso..."
              rows="4"
              class="w-4/5 border-0 border-b border-gray-300 focus:border-gray-900 focus:ring-0 pb-2 text-lg bg-transparent resize-none transition-colors placeholder:text-gray-400"
            ></textarea>
          </div>

          <!-- Submit Button -->
          <div class="flex justify-end">
            <button
              type="submit"
              class="bg-gray-900 text-white px-8 py-3 rounded-lg font-semibold hover:bg-gray-800 transition-all hover:shadow-lg"
            >
              Enviar
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</section>

<script>
  (function() {
    const form = document.getElementById('contact-form');
    const interestButtons = document.querySelectorAll('.interest-btn');
    const budgetButtons = document.querySelectorAll('.budget-btn');
    
    let selectedInterests = [];
    window.selectedBudget = null; // Hacer global para que el bot贸n de descuento pueda acceder

    // Manejar selecci贸n de intereses
    interestButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const interest = btn.getAttribute('data-interest');
        if (!interest) return;
        
        if (selectedInterests.includes(interest)) {
          selectedInterests = selectedInterests.filter(i => i !== interest);
          btn.classList.remove('bg-gray-900', 'text-white');
          btn.classList.add('bg-gray-100', 'text-gray-900');
        } else {
          selectedInterests.push(interest);
          btn.classList.remove('bg-gray-100', 'text-gray-900');
          btn.classList.add('bg-gray-900', 'text-white');
        }
      });
    });

    // Manejar selecci贸n de presupuesto
    budgetButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const budget = btn.getAttribute('data-budget');
        if (!budget) return;
        
        // Remover selecci贸n anterior
        budgetButtons.forEach(b => {
          b.classList.remove('bg-gray-900', 'text-white', 'ring-2', 'ring-purple-500');
          if (b.id !== 'discountButton') {
            b.classList.add('bg-gray-100', 'text-gray-900');
          }
        });
        
        // Seleccionar nuevo presupuesto
        window.selectedBudget = budget;
        if (btn.id === 'discountButton') {
          btn.classList.add('ring-2', 'ring-purple-500');
        } else {
          btn.classList.remove('bg-gray-100', 'text-gray-900');
          btn.classList.add('bg-gray-900', 'text-white');
        }
      });
    });

    // Manejar env铆o del formulario
    if (form) {
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const formData = new FormData(form);
        const data = {
          name: formData.get('name'),
          company: formData.get('company'),
          email: formData.get('email'),
          phone: formData.get('phone'),
          project: formData.get('project'),
          interests: selectedInterests,
          budget: window.selectedBudget
        };
        
        console.log('Form submitted:', data);
        alert('隆Gracias por tu mensaje! Te contactaremos pronto.');
        
        // Resetear formulario
        form.reset();
        selectedInterests = [];
        window.selectedBudget = null;
        
        // Resetear botones
        interestButtons.forEach(btn => {
          btn.classList.remove('bg-gray-900', 'text-white');
          btn.classList.add('bg-gray-100', 'text-gray-900');
        });
        
        budgetButtons.forEach(btn => {
          btn.classList.remove('bg-gray-900', 'text-white', 'ring-2', 'ring-purple-500');
          if (btn.id !== 'discountButton') {
            btn.classList.add('bg-gray-100', 'text-gray-900');
          }
        });
      });
    }
  })();

  // Bot贸n de descuento que evita ser clickeado
  (function() {
    const discountButton = document.getElementById('discountButton');
    if (!discountButton) return;

    const container = discountButton.parentElement;
    if (!container) return;

    let isMoving = false;
    let clickCount = 0;
    let returnToOriginalTimeout: ReturnType<typeof setTimeout> | undefined = undefined;
    let originalPosition = { x: 0, y: 0 };
    let isMouseNear = false;

    // Guardar posici贸n original
    function saveOriginalPosition() {
      const rect = discountButton.getBoundingClientRect();
      const containerRect = container.getBoundingClientRect();
      originalPosition = {
        x: rect.left - containerRect.left,
        y: rect.top - containerRect.top
      };
    }

    // Funci贸n para tirar confeti
    function triggerConfetti() {
      const colors = ['#8B5CF6', '#3B82F6', '#EC4899', '#10B981', '#F59E0B'];
      const confettiCount = 100;
      
      for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.style.position = 'fixed';
        confetti.style.width = '10px';
        confetti.style.height = '10px';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.top = '-10px';
        confetti.style.borderRadius = '50%';
        confetti.style.pointerEvents = 'none';
        confetti.style.zIndex = '9999';
        confetti.style.opacity = '1';
        
        document.body.appendChild(confetti);
        
        const angle = Math.random() * Math.PI * 2;
        const velocity = 2 + Math.random() * 3;
        const x = Math.cos(angle) * velocity;
        const y = Math.sin(angle) * velocity + 2;
        
        let posX = parseFloat(confetti.style.left);
        let posY = -10;
        
        function animate() {
          posX += x;
          posY += y;
          y += 0.1; // gravedad
          
          confetti.style.left = posX + 'px';
          confetti.style.top = posY + 'px';
          confetti.style.opacity = String(Math.max(0, parseFloat(confetti.style.opacity) - 0.01));
          
          if (posY < window.innerHeight && parseFloat(confetti.style.opacity) > 0) {
            requestAnimationFrame(animate);
          } else {
            confetti.remove();
          }
        }
        
        requestAnimationFrame(animate);
      }
    }

    function getRandomPosition() {
      if (!container || !discountButton) return { x: 0, y: 0 };
      const containerRect = container.getBoundingClientRect();
      const buttonRect = discountButton.getBoundingClientRect();
      
      // rea disponible para mover el bot贸n
      const maxX = containerRect.width - buttonRect.width;
      const maxY = containerRect.height - buttonRect.height;
      
      // Generar posici贸n aleatoria pero dentro del contenedor
      const randomX = Math.random() * Math.max(0, maxX);
      const randomY = Math.random() * Math.max(0, maxY);
      
      return {
        x: Math.max(0, randomX),
        y: Math.max(0, randomY)
      };
    }

    function moveButton() {
      if (isMoving || !discountButton || clickCount > 0) return;
      isMoving = true;
      isMouseNear = true;

      // Cancelar timeout de retorno si existe
      if (returnToOriginalTimeout !== undefined) {
        clearTimeout(returnToOriginalTimeout);
        returnToOriginalTimeout = undefined;
      }

      const position = getRandomPosition();
      
      discountButton.style.position = 'absolute';
      discountButton.style.transform = `translate(${position.x}px, ${position.y}px)`;
      
      setTimeout(() => {
        isMoving = false;
        
        // Despu茅s de 1.5 segundos, volver a posici贸n original si el mouse no est谩 cerca
        returnToOriginalTimeout = setTimeout(() => {
          if (!isMouseNear && clickCount === 0) {
            returnToOriginal();
          }
        }, 1500);
      }, 300);
    }

    function returnToOriginal() {
      if (!discountButton || clickCount > 0) return;
      
      discountButton.style.position = 'static';
      discountButton.style.transform = 'translate(0, 0)';
      isMouseNear = false;
    }

    // Guardar posici贸n original al cargar
    setTimeout(() => {
      saveOriginalPosition();
    }, 100);

    // Detectar cuando el mouse se acerca al bot贸n
    discountButton.addEventListener('mouseenter', function(e) {
      isMouseNear = true;
      if (returnToOriginalTimeout !== undefined) {
        clearTimeout(returnToOriginalTimeout);
        returnToOriginalTimeout = undefined;
      }
      // Solo mover si no ha sido clickeado a煤n
      if (clickCount === 0) {
        moveButton();
      }
    });

    discountButton.addEventListener('mouseleave', function(e) {
      isMouseNear = false;
    });

    // Detectar cuando el mouse est谩 cerca (dentro de un radio)
    container.addEventListener('mousemove', function(e) {
      if (clickCount > 0 || isMoving) return;

      const buttonRect = discountButton.getBoundingClientRect();
      
      const buttonCenterX = buttonRect.left + buttonRect.width / 2;
      const buttonCenterY = buttonRect.top + buttonRect.height / 2;
      
      const distance = Math.sqrt(
        Math.pow(e.clientX - buttonCenterX, 2) + 
        Math.pow(e.clientY - buttonCenterY, 2)
      );
      
      if (distance < 80) {
        isMouseNear = true;
        if (returnToOriginalTimeout !== undefined) {
          clearTimeout(returnToOriginalTimeout);
          returnToOriginalTimeout = undefined;
        }
        moveButton();
      } else {
        isMouseNear = false;
      }
    });

    // Permitir click despu茅s de varios intentos o si el usuario es persistente
    discountButton.addEventListener('click', function(e) {
      clickCount++;
      
      if (clickCount >= 3) {
        // Cancelar timeout de retorno
        if (returnToOriginalTimeout !== undefined) {
          clearTimeout(returnToOriginalTimeout);
          returnToOriginalTimeout = undefined;
        }
        
        // Despu茅s de 3 intentos, permitir el click
        discountButton.style.position = 'static';
        discountButton.style.transform = 'translate(0, 0)';
        discountButton.style.cursor = 'pointer';
        discountButton.classList.add('success');
        
        // Tirar confeti
        triggerConfetti();
        
        // Seleccionar el descuento como presupuesto
        const allBudgetButtons = document.querySelectorAll('.budget-btn');
        allBudgetButtons.forEach(b => {
          b.classList.remove('bg-gray-900', 'text-white', 'ring-2', 'ring-purple-500');
          if (b !== discountButton && b.id !== 'discountButton') {
            b.classList.add('bg-gray-100', 'text-gray-900');
          }
        });
        discountButton.classList.add('ring-2', 'ring-purple-500');
        
        // Actualizar el presupuesto seleccionado
        window.selectedBudget = 'Descuento 20%';
        
        // Aqu铆 puedes agregar la l贸gica del descuento
        setTimeout(() => {
          alert('隆Felicidades! Has obtenido un 20% de descuento. Usa el c贸digo: SLE20OFF');
        }, 500);
      } else {
        // Mover el bot贸n cuando intentan clickearlo
        e.preventDefault();
        moveButton();
      }
    });
  })();
</script>

<style>
  .discount-button {
    left: 0;
    top: 0;
    transform: translate(0, 0);
  }

  .discount-button.success {
    animation: pulse 0.5s ease-in-out;
  }

  @keyframes pulse {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
  }
</style>
